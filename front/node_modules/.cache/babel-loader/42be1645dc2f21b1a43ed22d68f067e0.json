{"ast":null,"code":"export default {\n  name: \"singleImageProcess_imageSendPart\",\n\n  data() {\n    return {\n      isUploaded: false,\n      uploadStatus_class: \"uploadStatus_red\",\n      blueImageChoose: false,\n      greenImageChoose: false,\n      additionInfo: {\n        sampleName: \"\",\n        part: \"\",\n        part_other: \"\",\n        remark: \"\"\n      },\n      part_Other: false,\n      part_diagnose: false\n    };\n  },\n\n  mounted() {\n    this.$bus.$on('sendUploadedInfoToGet', () => {\n      this.$bus.$emit(\"getUploadedInfo\", this.isUploaded);\n    });\n  },\n\n  beforeDestroy() {\n    this.$bus.$off(\"sendUploadedInfoToGet\");\n  },\n\n  methods: {\n    // cookie\n    getCookie(objName) {\n      //获取指定名称的cookie的值\n      const arrStr = document.cookie.split(\"; \");\n\n      for (let i = 0; i < arrStr.length; i++) {\n        const temp = arrStr[i].split(\"=\");\n        if (temp[0] === objName) return temp[1];\n      }\n\n      return null;\n    },\n\n    getToken() {\n      return this.getCookie(\"NBI_token\");\n    },\n\n    getUID() {\n      return this.getCookie(\"NBI_UID\");\n    },\n\n    uploadNewImage() {\n      if (!this.greenImageChoose || !this.blueImageChoose) {\n        this.$message({\n          message: '必须选择想要上传的原图片',\n          type: 'error'\n        });\n        return;\n      }\n\n      let uploadForm = new FormData(); // 图片数据\n\n      uploadForm.append(\"blueImage\", document.getElementById(\"blueImageButton\").files[0]);\n      uploadForm.append(\"greenImage\", document.getElementById(\"greenImageButton\").files[0]);\n      uploadForm.append(\"whiteImage\", document.getElementById(\"whiteImageButton\").files[0]); // 身份识别数据\n\n      uploadForm.append(\"uid\", this.getUID());\n      uploadForm.append(\"token\", this.getToken()); // 图片附加数据\n\n      uploadForm.append(\"sampleName\", this.additionInfo.sampleName);\n      uploadForm.append(\"remark\", this.additionInfo.remark);\n      const part = this.additionInfo.part === \"其他\" ? this.additionInfo.part_other : this.additionInfo.part;\n      uploadForm.append(\"part\", part);\n      const chooseList = document.getElementsByName(\"addInfo_diagnoseBefore_c\"); // 使用字符串数组，用于存放选择好了的数据\n\n      const chooseResult = [];\n\n      for (let i = 0; i < chooseList.length; i++) {\n        if (chooseList[i].selected === true) {\n          if (chooseList[i].value !== \"其他\") {\n            chooseResult.push(chooseList[i].value); //这个是获取多选框中的值\n          } else {\n            chooseResult.push(this.$refs.addInfo_diagnoseBefore_other.value); //这个是获取多选框中的值\n          }\n        }\n      }\n\n      uploadForm.append(\"diagnoseBefore\", chooseResult);\n      let config = {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      };\n      this.$refs.uploadStatus.innerText = \"上传中\";\n      this.uploadStatus_class = \"uploadStatus_yellow\";\n      this.$refs.uploadBtn.disabled = true;\n      this.$axios.post(\"/NBI/Image/upload/\", uploadForm, config).then(response => {\n        if (response.data === 1) {\n          this.$message({\n            message: '登录状态错误！请重新登录。',\n            type: 'error'\n          });\n          this.$refs.uploadStatus.innerText = \"等待上传\";\n          this.uploadStatus_class = \"uploadStatus_red\";\n        } else if (response.data === 2) {\n          this.$message({\n            message: '您提交的图片为空，请检查！',\n            type: 'error'\n          });\n          this.$refs.uploadStatus.innerText = \"等待上传\";\n          this.uploadStatus_class = \"uploadStatus_red\";\n        } else if (response.data === 3) {\n          this.$message({\n            message: '图片存储错误，目前仅支持常见图片格式。',\n            type: 'error'\n          });\n          this.$refs.uploadStatus.innerText = \"等待上传\";\n          this.uploadStatus_class = \"uploadStatus_red\";\n        } else {\n          const imageShow_blue = this.$refs.imageShow_blue;\n          imageShow_blue.className = \"uploadImageShow\";\n          imageShow_blue.src = \"/static/Data/Blue/\" + response.data.imageBlue;\n          const imageShow_green = this.$refs.imageShow_green;\n          imageShow_green.className = \"uploadImageShow\";\n          imageShow_green.src = \"/static/Data/Green/\" + response.data.imageGreen;\n\n          if (response.data.imageWhite !== null) {\n            const imageShow_white = this.$refs.imageShow_white;\n            imageShow_white.className = \"uploadImageShow\";\n            imageShow_white.src = \"/static/Data/White/\" + response.data.imageWhite;\n          }\n\n          this.$refs.uploadStatus.innerText = \"已上传\";\n          this.uploadStatus_class = \"uploadStatus_green\";\n          this.isUploaded = true;\n        }\n\n        this.$refs.uploadBtn.disabled = false;\n      });\n    },\n\n    chooseLastImage() {\n      let getLastUploadImageForm = new FormData(); // 身份识别数据\n\n      getLastUploadImageForm.append(\"uid\", this.getUID());\n      getLastUploadImageForm.append(\"token\", this.getToken());\n      let config = {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      };\n      this.$axios.post(\"/NBI/Image/chooseLastImage/\", getLastUploadImageForm, config).then(response => {\n        if (response.data === 2) {\n          this.$message({\n            message: '登录状态错误！请重新登录。',\n            type: 'error'\n          });\n        } else if (response.data === 1) {\n          this.$message({\n            message: '未发现上次上传的图片',\n            type: 'warning'\n          });\n        } else {\n          const imageShow_blue = this.$refs.imageShow_blue;\n          imageShow_blue.className = \"uploadImageShow\";\n          imageShow_blue.src = \"/static/Data/Blue/\" + response.data.imageBlue;\n          const imageShow_green = this.$refs.imageShow_green;\n          imageShow_green.className = \"uploadImageShow\";\n          imageShow_green.src = \"/static/Data/Green/\" + response.data.imageGreen;\n\n          if (response.data.imageWhite !== null) {\n            const imageShow_white = this.$refs.imageShow_white;\n            imageShow_white.className = \"uploadImageShow\";\n            imageShow_white.src = \"/static/Data/White/\" + response.data.imageWhite;\n            this.$refs.whiteImageShowBtn.innerText = \"已选择：\" + this.cutFileName(response.data.imageWhite.split(\"~\")[0] + '.' + response.data.imageWhite.split(\".\")[1]);\n          }\n\n          this.additionInfo.sampleName = response.data.sampleName;\n          this.additionInfo.remark = response.data.remark;\n          this.$refs.blueImageShowBtn.innerText = \"已选择：\" + this.cutFileName(response.data.imageBlue.split(\"~\")[0] + '.' + response.data.imageBlue.split(\".\")[1]);\n          this.$refs.greenImageShowBtn.innerText = \"已选择：\" + this.cutFileName(response.data.imageGreen.split(\"~\")[0] + '.' + response.data.imageGreen.split(\".\")[1]);\n          this.isUploaded = true;\n        }\n      });\n    },\n\n    addInfoPartChange() {\n      const choose = document.getElementById(\"addInfo_bodyPart\").value;\n      this.part_Other = choose === \"其他\";\n    },\n\n    addInfoDiagnoseBeforeChange() {\n      const chooseList = document.getElementsByName(\"addInfo_diagnoseBefore_c\"); // 使用字符串数组，用于存放选择好了的数据\n\n      const chooseResult = new Array(chooseList.length);\n\n      for (let i = 0; i < chooseList.length; i++) {\n        if (chooseList[i].selected === true) {\n          chooseResult[i] = chooseList[i].value; //这个是获取多选框中的值\n        }\n      }\n\n      this.part_diagnose = chooseResult[5] !== undefined;\n    },\n\n    chooseBlueImage() {\n      this.blueImageChoose = true;\n      this.$refs.blueImageChooseBtn.click();\n    },\n\n    chooseGreenImage() {\n      this.greenImageChoose = true;\n      this.$refs.greenImageChooseBtn.click();\n    },\n\n    chooseWhiteImage() {\n      this.$refs.whiteImageChooseBtn.click();\n    },\n\n    getFileName(o) {\n      const pos = o.lastIndexOf(\"\\\\\");\n\n      if (o.length < pos + 15) {\n        return o.substring(pos + 1);\n      } else {\n        return o.substring(pos + 1, pos + 10) + \"...\";\n      }\n    },\n\n    cutFileName(o) {\n      if (o.length < 15) {\n        return o;\n      } else {\n        return o.substring(0, 15) + \"...\";\n      }\n    },\n\n    getFileType(o) {\n      const pos = o.lastIndexOf(\".\");\n      return o.slice(pos + 1, o.length);\n    },\n\n    blueImageShowChange() {\n      const imageShow = this.$refs.imageShow_blue;\n      imageShow.className = \"uploadIcon\";\n      const blue_input = this.$refs.blueImageChooseBtn;\n      this.$refs.blueImageShowBtn.innerText = \"已选择：\" + this.getFileName(blue_input.value);\n      const fileType = this.getFileType(blue_input.value);\n\n      if (fileType === \"jpg\" || fileType === \"JPG\" || fileType === \"jpeg\") {\n        const file = blue_input.files[0]; // 获取input上传的图片数据;\n\n        let read = new FileReader(); // 创建FileReader对像;\n\n        read.readAsDataURL(file); // 调用readAsDataURL方法读取文件;\n\n        read.onload = function () {\n          // 拿到读取结果;\n          imageShow.src = read.result;\n        };\n\n        imageShow.className = \"uploadImageShow\";\n      } else {\n        imageShow.src = \"/static/unknownImageTypeIcon.png\";\n      }\n    },\n\n    greenImageShowChange() {\n      const imageShow = this.$refs.imageShow_green;\n      imageShow.className = \"uploadIcon\";\n      const green_input = this.$refs.greenImageChooseBtn;\n      this.$refs.greenImageShowBtn.innerText = \"已选择：\" + this.getFileName(green_input.value);\n      const fileType = this.getFileType(green_input.value);\n\n      if (fileType === \"jpg\" || fileType === \"JPG\" || fileType === \"jpeg\") {\n        const file = green_input.files[0]; // 获取input上传的图片数据;\n\n        let read = new FileReader(); // 创建FileReader对像;\n\n        read.readAsDataURL(file); // 调用readAsDataURL方法读取文件;\n\n        read.onload = function () {\n          // 拿到读取结果;\n          imageShow.src = read.result;\n        };\n\n        imageShow.className = \"uploadImageShow\";\n      } else {\n        imageShow.src = \"/static/unknownImageTypeIcon.png\";\n      }\n    },\n\n    whiteImageShowChange() {\n      const imageShow = this.$refs.imageShow_white;\n      imageShow.className = \"uploadIcon\";\n      const white_input = this.$refs.whiteImageChooseBtn;\n      this.$refs.whiteImageShowBtn.innerText = \"已选择：\" + this.getFileName(white_input.value);\n      const fileType = this.getFileType(white_input.value);\n\n      if (fileType === \"jpg\" || fileType === \"JPG\" || fileType === \"jpeg\") {\n        const file = white_input.files[0]; // 获取input上传的图片数据;\n\n        let read = new FileReader(); // 创建FileReader对像;\n\n        read.readAsDataURL(file); // 调用readAsDataURL方法读取文件;\n\n        read.onload = function () {\n          // 拿到读取结果;\n          imageShow.src = read.result;\n        };\n\n        imageShow.className = \"uploadImageShow\";\n      } else {\n        imageShow.src = \"/static/unknownImageTypeIcon.png\";\n      }\n    }\n\n  }\n};","map":{"version":3,"mappings":"AAiHA;EACAA,wCADA;;EAEAC;IACA;MACAC,iBADA;MAEAC,sCAFA;MAGAC,sBAHA;MAIAC,uBAJA;MAKAC;QACAC,cADA;QAEAC,QAFA;QAGAC,cAHA;QAIAC;MAJA,CALA;MAWAC,iBAXA;MAYAC;IAZA;EAcA,CAjBA;;EAkBAC;IACA;MACA;IACA,CAFA;EAGA,CAtBA;;EAuBAC;IACA;EACA,CAzBA;;EA0BAC;IACA;IACAC;MAAA;MACA;;MACA;QACA;QACA;MACA;;MACA;IACA,CATA;;IAUAC;MACA;IACA,CAZA;;IAaAC;MACA;IACA,CAfA;;IAgBAC;MACA;QACA;UACAC,uBADA;UAEAC;QAFA;QAIA;MACA;;MACA,gCARA,CASA;;MACAC;MACAA;MACAA,sFAZA,CAaA;;MACAA;MACAA,4CAfA,CAgBA;;MACAA;MACAA;MACA;MACAA;MACA,0EArBA,CAsBA;;MACA;;MACA;QACA;UACA;YACAC,uCADA,CACA;UACA,CAFA,MAGA;YACAA,iEADA,CACA;UACA;QACA;MACA;;MACAD;MACA;QACAE;UAAA;QAAA;MADA;MAGA;MACA;MACA;MACA;QACA;UACA;YACAJ,wBADA;YAEAC;UAFA;UAIA;UACA;QACA,CAPA,MAQA;UACA;YACAD,wBADA;YAEAC;UAFA;UAIA;UACA;QACA,CAPA,MAQA;UACA;YACAD,8BADA;YAEAC;UAFA;UAIA;UACA;QACA,CAPA,MAQA;UACA;UACAI;UACAA;UACA;UACAC;UACAA;;UACA;YACA;YACAC;YACAA;UACA;;UACA;UACA;UACA;QACA;;QACA;MACA,CA1CA;IA2CA,CApGA;;IAqGAC;MACA,4CADA,CAEA;;MACAC;MACAA;MACA;QACAL;UAAA;QAAA;MADA;MAGA;QACA;UACA;YACAJ,wBADA;YAEAC;UAFA;QAIA,CALA,MAMA;UACA;YACAD,qBADA;YAEAC;UAFA;QAIA,CALA,MAMA;UACA;UACAI;UACAA;UACA;UACAC;UACAA;;UACA;YACA;YACAC;YACAA;YACA;UACA;;UACA;UACA;UAEA;UACA;UACA;QACA;MACA,CAjCA;IAkCA,CA/IA;;IAgJAG;MACA;MACA;IACA,CAnJA;;IAoJAC;MACA,0EADA,CAEA;;MACA;;MACA;QACA;UACAR,sCADA,CACA;QACA;MACA;;MACA;IACA,CA9JA;;IA+JAS;MACA;MACA;IACA,CAlKA;;IAmKAC;MACA;MACA;IACA,CAtKA;;IAuKAC;MACA;IACA,CAzKA;;IA0KAC;MACA;;MACA;QACA;MACA,CAFA,MAGA;QACA;MACA;IACA,CAlLA;;IAmLAC;MACA;QACA;MACA,CAFA,MAGA;QACA;MACA;IACA,CA1LA;;IA2LAC;MACA;MACA;IACA,CA9LA;;IA+LAC;MACA;MACAC;MACA;MACA;MACA;;MACA;QACA,iCADA,CACA;;QACA,4BAFA,CAEA;;QACAC,yBAHA,CAGA;;QACAA;UACA;UACAD;QACA,CAHA;;QAIAA;MACA,CATA,MASA;QACAA;MACA;IACA,CAjNA;;IAkNAE;MACA;MACAF;MACA;MACA;MACA;;MACA;QACA,kCADA,CACA;;QACA,4BAFA,CAEA;;QACAC,yBAHA,CAGA;;QACAA;UACA;UACAD;QACA,CAHA;;QAIAA;MACA,CATA,MASA;QACAA;MACA;IACA,CApOA;;IAqOAG;MACA;MACAH;MACA;MACA;MACA;;MACA;QACA,kCADA,CACA;;QACA,4BAFA,CAEA;;QACAC,yBAHA,CAGA;;QACAA;UACA;UACAD;QACA,CAHA;;QAIAA;MACA,CATA,MASA;QACAA;MACA;IACA;;EAvPA;AA1BA","names":["name","data","isUploaded","uploadStatus_class","blueImageChoose","greenImageChoose","additionInfo","sampleName","part","part_other","remark","part_Other","part_diagnose","mounted","beforeDestroy","methods","getCookie","getToken","getUID","uploadNewImage","message","type","uploadForm","chooseResult","headers","imageShow_blue","imageShow_green","imageShow_white","chooseLastImage","getLastUploadImageForm","addInfoPartChange","addInfoDiagnoseBeforeChange","chooseBlueImage","chooseGreenImage","chooseWhiteImage","getFileName","cutFileName","getFileType","blueImageShowChange","imageShow","read","greenImageShowChange","whiteImageShowChange"],"sourceRoot":"src/components/singleImageProcess","sources":["singleImageProcess_imageSendPart.vue"],"sourcesContent":["<template>\n  <div id=\"imgPart\">\n    <div class=\"subTitle\">\n      <p style=\"height: 50%;font-family: STHeiti,serif;color: #363636;display: flex;justify-content: center;margin-left: 2%;\">图片上传(Image Upload):</p>\n      <div style=\"width: 100%;height: 50%;display: flex;flex-direction: row;\">\n        <div id=\"uploadBtnContainer\">\n          <el-button icon=\"el-icon-upload2\" type=\"primary\" ref=\"uploadBtn\" @click=\"uploadNewImage()\" style=\"width: 90%;border-radius: 5px;font-size: small\">开始上传</el-button>\n        </div>\n        <div id=\"uploadStatus\">\n            <p ref=\"uploadStatus\" :class=\"uploadStatus_class\">等待上传</p>\n        </div>\n        <div id=\"chooseLastImageBtn\" @click=\"chooseLastImage()\">\n            <p>选择上次上传图片>>></p>\n        </div>\n      </div>\n    </div>\n    <div class=\"imgPart_inner\">\n      <div class=\"innerTitle\">\n          <p style=\"overflow: hidden;width:13%;font-family: 幼圆,serif;color: #363636;display: flex;justify-content: flex-start;margin-left: 3%\">图片信息</p>\n          <p style=\"margin-left: 5%;color: red;font-family: 幼圆,serif\">*必须</p>\n      </div>\n      <div id=\"imgSendContainer\">\n          <div id=\"imgSendPart_blue\" @click=\"chooseBlueImage()\">\n              <div id=\"blueImageShowField\">\n                  <img ref=\"imageShow_blue\" src=\"@/assets/uploadicon.png\" id=\"icon_blue\" class=\"uploadIcon\" alt=\"图片加载失败\">\n              </div>\n              <div style=\"width: 100%; height: 16%;\">\n                  <div ref=\"blueImageShowBtn\" class=\"uploadButton\" @click=\"chooseBlueImage()\">选择蓝色光源图片(415nm)</div>\n                  <!--这个提交按钮太丑了，隐藏-->\n                  <input ref=\"blueImageChooseBtn\" id=\"blueImageButton\" type=\"file\" style=\"margin-top: 400px\" @change=\"blueImageShowChange()\">\n              </div>\n          </div>\n          <div id=\"imgSendPart_green\" @click=\"chooseGreenImage()\">\n              <div id=\"greenImageShowField\">\n                  <img ref=\"imageShow_green\" src=\"@/assets/uploadicon.png\" id=\"icon_green\" class=\"uploadIcon\" alt=\"图片加载失败\">\n              </div>\n              <div style=\"width: 100%; height: 16%;\">\n                  <div ref=\"greenImageShowBtn\" class=\"uploadButton\" id=\"greenImageButton_Show\" @click=\"chooseGreenImage()\" style=\"color: rgb(49,143,63)\">选择绿色光源图片(540nm)</div>\n                  <input ref=\"greenImageChooseBtn\" id=\"greenImageButton\" type=\"file\" style=\"margin-top: 400px\" @change=\"greenImageShowChange()\">\n              </div>\n          </div>\n          <div id=\"imgSendPart_white\" @click=\"chooseWhiteImage()\">\n              <div id=\"whiteImageShowField\">\n                  <img ref=\"imageShow_white\" src=\"@/assets/uploadicon.png\" id=\"icon_white\" class=\"uploadIcon\" alt=\"图片加载失败\">\n              </div>\n              <div style=\"width: 100%; height: 16%;\">\n                  <div ref=\"whiteImageShowBtn\" class=\"uploadButton\" id=\"whiteImageButton_Show\" @click=\"chooseWhiteImage()\" style=\"background-color: rgba(255, 255, 255, 0.4); color: black;border: 2px solid #323232;\">选择白色光源图片(非必须)</div>\n                  <input ref=\"whiteImageChooseBtn\" id=\"whiteImageButton\" type=\"file\" style=\"margin-top: 400px\" @change=\"whiteImageShowChange()\">\n              </div>\n          </div>\n      </div>\n      <div class=\"innerTitle\" style=\"border-top: 1px #d0d0d0 solid; margin-top: 5px\">\n          <p style=\"overflow: hidden;width:13%;font-family: 幼圆,serif;color: #363636;display: flex;justify-content: flex-start;margin-left: 3%\">附加信息</p>\n          <p style=\"margin-left: 5%;color: rgb(19, 124, 0);font-family: 幼圆,serif\">*非必须</p>\n      </div>\n      <div id=\"imgSend_addInfoContainer\">\n        <div style=\"width: 50%;height: 100%; display: block;justify-content: left;\">\n            <div class=\"addInfo\">\n                <p class=\"addInfo_formLabel\">标本名称：</p>\n                <input v-model=\"additionInfo.sampleName\" class=\"addInfo_formInput\" id=\"addInfo_sampleName\" AUTOCOMPLETE=\"off\" type=\"text\" placeholder=\"输入标本名称\"/>\n                <p style=\"color: red;width: 5%;text-align: center;\"></p>\n            </div>\n            <div id=\"addInfo_bodyPart_Container\" style=\"display: flex;flex-direction: column;\">\n                <div class=\"addInfo\">\n                    <p class=\"addInfo_formLabel\">    部位：</p>\n                    <select v-model=\"additionInfo.part\" class=\"addInfo_choose\" id=\"addInfo_bodyPart\" @change=\"addInfoPartChange()\">\n                        <option>    食管</option>\n                        <option>    胃</option>\n                        <option>    小肠</option>\n                        <option>    大肠</option>\n                        <option>    其他</option>\n                    </select>\n                    <p style=\"color: red;width: 5%;text-align: center;\"></p>\n                </div>\n                <div v-show=\"part_Other\"  class=\"addInfo\" id=\"addInfo_bodyPart_other_Container\">\n                  <p class=\"addInfo_formLabel\"></p>\n                  <input v-model=\"additionInfo.part_other\" class=\"addInfo_formInput\" id=\"addInfo_bodyPart_other\" AUTOCOMPLETE=\"off\" type=\"text\" placeholder=\"输入其他标本部位名称\"/>\n                  <p style=\"color: red;width: 5%;text-align: center;\"></p>\n                </div>\n            </div>\n            <div class=\"addInfo\">\n                <p class=\"addInfo_formLabel\">        备注：</p>\n                <div style=\"width: 60%;height: 100px;display: flex;justify-content: center;align-items: center;overflow: hidden;\">\n                    <textarea v-model=\"additionInfo.remark\" style=\"font-family: Arial, Helvetica, sans-serif; font-size: 14px;height: 92%; width: 100%;resize: none;\" placeholder=\"备注\"></textarea>\n                </div>\n                <p style=\"color: red;width: 5%;text-align: center;\"></p>\n            </div>\n        </div>\n        <div style=\"width: 50%; height: 100%; display: flex;flex-direction: column;\">\n            <div id=\"addInfo_diagnoseBefore_Container\" style=\"display: flex;flex-direction: column;\">\n                <div class=\"addInfo\">\n                    <p class=\"addInfo_formLabel\">术前诊断：<br>(可按住shift多选)</p>\n                    <select multiple=\"multiple\" style=\"width: 60%;height: 200px;\" id=\"addInfo_diagnoseBefore\" @change=\"addInfoDiagnoseBeforeChange()\">\n                        <option name=\"addInfo_diagnoseBefore_c\" class=\"addInfo_choose\" style=\"width: 100%; display: flex;align-items: center;justify-content: left;\">    早癌</option>\n                        <option name=\"addInfo_diagnoseBefore_c\" class=\"addInfo_choose\" style=\"width: 100%; display: flex;align-items: center;justify-content: left;\">    LGIN</option>\n                        <option name=\"addInfo_diagnoseBefore_c\" class=\"addInfo_choose\" style=\"width: 100%; display: flex;align-items: center;justify-content: left;\">    腺瘤</option>\n                        <option name=\"addInfo_diagnoseBefore_c\" class=\"addInfo_choose\" style=\"width: 100%; display: flex;align-items: center;justify-content: left;\">    SMT</option>\n                        <option name=\"addInfo_diagnoseBefore_c\" class=\"addInfo_choose\" style=\"width: 100%; display: flex;align-items: center;justify-content: left;\">    炎症</option>\n                        <option id=\"addInfo_diagnoseBefore_other_option\" name=\"addInfo_diagnoseBefore_c\" class=\"addInfo_choose\" style=\"width: 100%; display: flex;align-items: center;justify-content: left;\">    其他</option>\n                    </select>\n                </div>\n                <div v-show=\"part_diagnose\" class=\"addInfo\" id=\"addInfo_diagnoseBefore_other_Container\">\n                    <p class=\"addInfo_formLabel\"></p>\n                    <input ref=\"addInfo_diagnoseBefore_other\" class=\"addInfo_formInput\" AUTOCOMPLETE=\"off\" type=\"text\" placeholder=\"    输入其他早期诊断结论\"/>\n                </div>\n            </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: \"singleImageProcess_imageSendPart\",\n  data(){\n    return {\n      isUploaded: false,\n      uploadStatus_class: \"uploadStatus_red\",\n      blueImageChoose: false,\n      greenImageChoose: false,\n      additionInfo:{\n        sampleName: \"\",\n        part: \"\",\n        part_other: \"\",\n        remark: \"\",\n      },\n      part_Other: false,\n      part_diagnose: false,\n    }\n  },\n  mounted() {\n    this.$bus.$on('sendUploadedInfoToGet',()=>{\n      this.$bus.$emit(\"getUploadedInfo\",this.isUploaded);\n    })\n  },\n  beforeDestroy() {\n    this.$bus.$off(\"sendUploadedInfoToGet\");\n  },\n  methods:{\n    // cookie\n    getCookie(objName){//获取指定名称的cookie的值\n      const arrStr = document.cookie.split(\"; \");\n      for(let i = 0; i < arrStr.length; i ++){\n        const temp = arrStr[i].split(\"=\");\n        if(temp[0] === objName) return temp[1];\n      }\n      return null;\n    },\n    getToken(){\n      return this.getCookie(\"NBI_token\");\n    },\n    getUID(){\n      return this.getCookie(\"NBI_UID\");\n    },\n    uploadNewImage(){\n      if (!this.greenImageChoose || !this.blueImageChoose){\n        this.$message({\n          message: '必须选择想要上传的原图片',\n          type: 'error'\n        });\n        return;\n      }\n      let uploadForm = new FormData();\n      // 图片数据\n      uploadForm.append(\"blueImage\", document.getElementById(\"blueImageButton\").files[0]);\n      uploadForm.append(\"greenImage\", document.getElementById(\"greenImageButton\").files[0]);\n      uploadForm.append(\"whiteImage\", document.getElementById(\"whiteImageButton\").files[0]);\n      // 身份识别数据\n      uploadForm.append(\"uid\", this.getUID());\n      uploadForm.append(\"token\", this.getToken());\n      // 图片附加数据\n      uploadForm.append(\"sampleName\", this.additionInfo.sampleName);\n      uploadForm.append(\"remark\", this.additionInfo.remark);\n      const part = this.additionInfo.part === \"其他\"? this.additionInfo.part_other: this.additionInfo.part;\n      uploadForm.append(\"part\", part);\n      const chooseList = document.getElementsByName(\"addInfo_diagnoseBefore_c\");\n      // 使用字符串数组，用于存放选择好了的数据\n      const chooseResult = [];\n      for(let i = 0;i < chooseList.length;i++) {\n          if (chooseList[i].selected === true) {\n            if (chooseList[i].value !== \"其他\"){\n              chooseResult.push(chooseList[i].value);//这个是获取多选框中的值\n            }\n            else{\n              chooseResult.push(this.$refs.addInfo_diagnoseBefore_other.value);//这个是获取多选框中的值\n            }\n          }\n      }\n      uploadForm.append(\"diagnoseBefore\", chooseResult);\n      let config = {\n         headers: {'Content-Type': 'multipart/form-data'}\n      };\n      this.$refs.uploadStatus.innerText = \"上传中\";\n      this.uploadStatus_class = \"uploadStatus_yellow\";\n      this.$refs.uploadBtn.disabled = true;\n      this.$axios.post(\"/NBI/Image/upload/\",uploadForm, config).then((response) => {\n        if (response.data === 1){\n            this.$message({\n              message: '登录状态错误！请重新登录。',\n              type: 'error'\n            });\n            this.$refs.uploadStatus.innerText = \"等待上传\";\n            this.uploadStatus_class = \"uploadStatus_red\";\n        }\n        else if (response.data === 2){\n            this.$message({\n              message: '您提交的图片为空，请检查！',\n              type: 'error'\n            });\n            this.$refs.uploadStatus.innerText = \"等待上传\";\n            this.uploadStatus_class = \"uploadStatus_red\";\n        }\n        else if (response.data === 3){\n            this.$message({\n              message: '图片存储错误，目前仅支持常见图片格式。',\n              type: 'error'\n            });\n            this.$refs.uploadStatus.innerText = \"等待上传\";\n            this.uploadStatus_class = \"uploadStatus_red\";\n        }\n        else{\n          const imageShow_blue = this.$refs.imageShow_blue;\n          imageShow_blue.className = \"uploadImageShow\";\n          imageShow_blue.src = \"/static/Data/Blue/\"+response.data.imageBlue;\n          const imageShow_green = this.$refs.imageShow_green;\n          imageShow_green.className = \"uploadImageShow\";\n          imageShow_green.src = \"/static/Data/Green/\"+response.data.imageGreen;\n          if (response.data.imageWhite !== null){\n            const imageShow_white = this.$refs.imageShow_white;\n            imageShow_white.className = \"uploadImageShow\";\n            imageShow_white.src = \"/static/Data/White/\"+response.data.imageWhite;\n          }\n          this.$refs.uploadStatus.innerText = \"已上传\";\n          this.uploadStatus_class = \"uploadStatus_green\";\n          this.isUploaded = true;\n        }\n        this.$refs.uploadBtn.disabled = false;\n      });\n    },\n    chooseLastImage(){\n      let getLastUploadImageForm = new FormData();\n      // 身份识别数据\n      getLastUploadImageForm.append(\"uid\", this.getUID());\n      getLastUploadImageForm.append(\"token\", this.getToken());\n      let config = {\n         headers: {'Content-Type': 'multipart/form-data'}\n      };\n      this.$axios.post(\"/NBI/Image/chooseLastImage/\",getLastUploadImageForm, config).then((response) => {\n        if (response.data === 2){\n            this.$message({\n              message: '登录状态错误！请重新登录。',\n              type: 'error'\n            });\n        }\n        else if (response.data === 1){\n            this.$message({\n              message: '未发现上次上传的图片',\n              type: 'warning'\n            });\n        }\n        else{\n          const imageShow_blue = this.$refs.imageShow_blue;\n          imageShow_blue.className = \"uploadImageShow\";\n          imageShow_blue.src = \"/static/Data/Blue/\"+response.data.imageBlue;\n          const imageShow_green = this.$refs.imageShow_green;\n          imageShow_green.className = \"uploadImageShow\";\n          imageShow_green.src = \"/static/Data/Green/\"+response.data.imageGreen;\n          if (response.data.imageWhite !== null){\n            const imageShow_white = this.$refs.imageShow_white;\n            imageShow_white.className = \"uploadImageShow\";\n            imageShow_white.src = \"/static/Data/White/\"+response.data.imageWhite;\n            this.$refs.whiteImageShowBtn.innerText = \"已选择：\"+this.cutFileName(response.data.imageWhite.split(\"~\")[0]+'.'+response.data.imageWhite.split(\".\")[1]);\n          }\n          this.additionInfo.sampleName = response.data.sampleName;\n          this.additionInfo.remark = response.data.remark;\n\n          this.$refs.blueImageShowBtn.innerText = \"已选择：\"+this.cutFileName(response.data.imageBlue.split(\"~\")[0]+'.'+response.data.imageBlue.split(\".\")[1]);\n          this.$refs.greenImageShowBtn.innerText = \"已选择：\"+this.cutFileName(response.data.imageGreen.split(\"~\")[0]+'.'+response.data.imageGreen.split(\".\")[1]);\n          this.isUploaded = true;\n        }\n      });\n    },\n    addInfoPartChange(){\n      const choose = document.getElementById(\"addInfo_bodyPart\").value;\n      this.part_Other = choose === \"其他\";\n    },\n    addInfoDiagnoseBeforeChange(){\n      const chooseList = document.getElementsByName(\"addInfo_diagnoseBefore_c\");\n      // 使用字符串数组，用于存放选择好了的数据\n      const chooseResult = new Array(chooseList.length);\n      for(let i = 0;i < chooseList.length;i++) {\n          if (chooseList[i].selected === true) {\n              chooseResult[i] = chooseList[i].value;//这个是获取多选框中的值\n          }\n      }\n      this.part_diagnose = chooseResult[5] !== undefined;\n    },\n    chooseBlueImage(){\n      this.blueImageChoose = true;\n      this.$refs.blueImageChooseBtn.click();\n    },\n    chooseGreenImage(){\n      this.greenImageChoose = true;\n      this.$refs.greenImageChooseBtn.click();\n    },\n    chooseWhiteImage(){\n      this.$refs.whiteImageChooseBtn.click();\n    },\n    getFileName(o){\n      const pos = o.lastIndexOf(\"\\\\\");\n      if (o.length < pos+15){\n        return o.substring(pos+1);\n      }\n      else{\n        return o.substring(pos+1,pos+10) + \"...\";\n      }\n    },\n    cutFileName(o){\n      if (o.length < 15){\n        return o;\n      }\n      else{\n        return o.substring(0,15) + \"...\";\n      }\n    },\n    getFileType(o){\n      const pos = o.lastIndexOf(\".\");\n      return o.slice(pos+1, o.length);\n    },\n    blueImageShowChange(){\n      const imageShow = this.$refs.imageShow_blue;\n      imageShow.className = \"uploadIcon\";\n      const blue_input = this.$refs.blueImageChooseBtn;\n      this.$refs.blueImageShowBtn.innerText = \"已选择：\"+this.getFileName(blue_input.value);\n      const fileType = this.getFileType(blue_input.value);\n      if (fileType === \"jpg\" || fileType ===\"JPG\" || fileType===\"jpeg\"){\n        const file = blue_input.files[0]; // 获取input上传的图片数据;\n        let read = new FileReader(); // 创建FileReader对像;\n        read.readAsDataURL(file); // 调用readAsDataURL方法读取文件;\n        read.onload = function() {\n          // 拿到读取结果;\n          imageShow.src = read.result;\n        }\n        imageShow.className = \"uploadImageShow\";\n      }else{\n        imageShow.src = \"/static/unknownImageTypeIcon.png\";\n      }\n    },\n    greenImageShowChange(){\n      const imageShow = this.$refs.imageShow_green;\n      imageShow.className = \"uploadIcon\";\n      const green_input = this.$refs.greenImageChooseBtn;\n      this.$refs.greenImageShowBtn.innerText = \"已选择：\"+this.getFileName(green_input.value);\n      const fileType = this.getFileType(green_input.value);\n      if (fileType === \"jpg\" || fileType ===\"JPG\" || fileType===\"jpeg\"){\n        const file = green_input.files[0]; // 获取input上传的图片数据;\n        let read = new FileReader(); // 创建FileReader对像;\n        read.readAsDataURL(file); // 调用readAsDataURL方法读取文件;\n        read.onload = function() {\n          // 拿到读取结果;\n          imageShow.src = read.result;\n        }\n        imageShow.className = \"uploadImageShow\";\n      }else{\n        imageShow.src = \"/static/unknownImageTypeIcon.png\";\n      }\n    },\n    whiteImageShowChange(){\n      const imageShow = this.$refs.imageShow_white;\n      imageShow.className = \"uploadIcon\";\n      const white_input = this.$refs.whiteImageChooseBtn;\n      this.$refs.whiteImageShowBtn.innerText = \"已选择：\"+this.getFileName(white_input.value);\n      const fileType = this.getFileType(white_input.value);\n      if (fileType === \"jpg\" || fileType ===\"JPG\" || fileType===\"jpeg\"){\n        const file = white_input.files[0]; // 获取input上传的图片数据;\n        let read = new FileReader(); // 创建FileReader对像;\n        read.readAsDataURL(file); // 调用readAsDataURL方法读取文件;\n        read.onload = function() {\n          // 拿到读取结果;\n          imageShow.src = read.result;\n        }\n        imageShow.className = \"uploadImageShow\";\n      }else{\n        imageShow.src = \"/static/unknownImageTypeIcon.png\";\n      }\n    },\n  },\n}\n</script>\n\n<style scoped>\n#imgPart{\n  width: 100%;\n  /* height: 100%; */\n  overflow: hidden;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-direction: column;\n}\n.subTitle{\n    display: flex;\n    align-items: flex-start;\n    flex-direction: column;\n    justify-content: left;\n    width: 100%;\n    height: 100px;\n    border-bottom: 1px #cbcbcb solid;\n    overflow: hidden;\n}\n#uploadBtnContainer{\n    width: 32%;\n    height: 70%;\n    margin-left: 3%;\n    display: flex;\n    flex-direction: row;\n    justify-content: start;\n    align-items: center;\n    overflow: hidden;\n}\n#chooseLastImageBtn{\n    margin-left: 20%;\n    margin-right: 3%;\n    width: 30%;\n    height: 70%;\n    cursor: pointer;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    font-family: Arial, Helvetica, sans-serif;\n    color: rgb(37, 70, 255);\n    transition: 0.3s ease;\n    font-size: small;\n    border:rgb(37, 70, 255) 1px solid ;\n    border-radius: 3px;\n}\n\n#chooseLastImageBtn:hover{\n    color: rgb(91, 115, 255);\n    border:rgb(91, 115, 255) 1px solid ;\n}\n\n#uploadStatus{\n    margin-left: 0;\n    width: 18%;\n    height: 70%;\n    display: flex;\n    align-items: center;\n    justify-content: start;\n}\n.uploadStatus_red{\n  font-family: 幼圆,serif;\n  font-weight: bold;\n  color: rgb(217, 8, 8);\n}\n.uploadStatus_yellow{\n  font-family: 幼圆,serif;\n  font-weight: bold;\n  color: rgb(255, 183, 82);\n}\n.uploadStatus_green{\n  font-family: 幼圆,serif;\n  font-weight: bold;\n  color: rgb(34, 255, 0);\n}\n\n.imgPart_inner{\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    flex-direction: column;\n}\n\n#imgSendContainer{\n    display: flex;\n    flex-direction: row;\n    width: 100%;\n    height: 180px;\n    justify-content: start;\n    align-items: center;\n}\n\n#imgSendPart_blue{\n    width: 30%;\n    height: 90%;\n    border-radius: 3px;\n    align-content: center;\n    overflow: hidden;\n    margin-right: 1%;\n    margin-left: 3%;\n}\n#blueImageShowField{\n  background-color: rgba(154, 198, 255, 0.95);\n  border: 2px solid rgba(0, 0, 0, 0.8);\n  width: 98%;\n  height:80%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  transition: 0.3s;\n  cursor: pointer;\n}\n#blueImageShowField:hover{\n    background-color: rgba(154, 198, 255, 0.5);\n}\n\n#imgSendPart_green{\n    width: 30%;\n    height: 90%;\n    border-radius: 3px;\n    align-content: center;\n    overflow: hidden;\n    margin-right: 1%;\n}\n\n#greenImageShowField{\n  background-color: rgba(154, 255, 171, 0.95);\n  border: 2px solid rgba(0, 0, 0, 0.8);\n  width: 98%;\n  height:80%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  transition: 0.3s;\n  cursor: pointer;\n}\n#greenImageShowField:hover{\n    background-color: rgba(154, 255, 171, 0.5);\n}\n\n#imgSendPart_white{\n    width: 30%;\n    height: 90%;\n    border-radius: 3px;\n    align-content: center;\n    transition: 0.3s;\n    overflow: hidden;\n}\n\n#whiteImageShowField{\n  background-color: rgba(154, 255, 171, 0);\n  border: 2px solid rgba(0, 0, 0, 0.8);\n  width: 98%;\n  height:80%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  transition: 0.3s;\n  cursor: pointer;\n}\n#whiteImageShowField:hover{\n    background-color: rgba(228, 228, 228, 0.15);\n}\n\n.innerTitle{\n    display: flex;\n    align-items: center;\n    flex-direction: row;\n    justify-content: left;\n    width: 100%;\n    height: 30px;\n    overflow: hidden;\n}\n\n.uploadButton {\n    transition: 0.1s ease;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex: 1 1 auto;\n    height: 95%;\n    border: 2px solid black;\n    border-radius: 5px;\n    text-align: center;\n    position: relative;\n    overflow: hidden;\n    font-family: STHeiti;\n    font-size: smaller;\n    color: blue;\n    overflow: hidden;\n}\n.uploadButton:after {\n    position: absolute;\n    transition: 0.3s;\n    content: \"\";\n    width: 0;\n    left: 50%;\n    bottom: 0;\n    height: 3px;\n    background: #ff906c;\n}\n.uploadButton:hover {\n    cursor: pointer;\n}\n.uploadButton:hover:after {\n    width: 100%;\n    left: 0;\n}\n\n.uploadIcon{\n    height: 60%;\n    margin-top: 5%;\n}\n/*当展示上传的图片时显示这个样式*/\n.uploadImageShow{\n    height: 100%;\n}\n\n#imgSend_addInfoContainer{\n    display: flex;\n    flex-direction: row;\n    margin-top: 10px;\n    width: 100%;\n    height: 280px;\n    justify-content: center;\n    align-items: center;\n}\n.addInfo{\n    display: flex;\n    flex-direction: row;\n    width: 95%;\n    justify-content: center;\n    align-items: center;\n}\n.addInfo_formLabel{\n    width: 40%;\n    height: 30px;\n    overflow: hidden;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  font-size: small;\n}\n.addInfo_formInput{\n    width: 60%;\n    height: 30px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    box-sizing: border-box;\n    text-align:left;\n    border-radius:4px;\n    border:1px solid #c8cccf;\n    color:#6a6f77;\n}\n.addInfo_choose{\n    width: 60%;\n    height: 40px;\n\tdisplay: flex;\n    align-items: center;\n    justify-content: center;\n    box-sizing: border-box;\n    text-align:left;\n    border-radius:4px;\n    border:1px solid #c8cccf;\n    color:#6a6f77;\n}\n</style>"]},"metadata":{},"sourceType":"module"}