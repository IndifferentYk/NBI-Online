{"ast":null,"code":"export default {\n  name: \"singleImageProcess_imageGetPart\",\n\n  data() {\n    return {\n      channelOffset: 0,\n      brightnessOffset: 0,\n      isGenerating: false,\n      isUploaded_fromSend: false,\n      fromAdjust: {\n        isOpen: false,\n        contrastOffset: 0,\n        luminosityOffset: 0,\n        saturationOffset: 0\n      },\n      recordRealResult: \"\",\n      isShowResult: false,\n      imageResultSrc: \"\"\n    };\n  },\n\n  mounted() {\n    this.$bus.$on(\"getUploadedInfo\", data => {\n      this.isUploaded_fromSend = data;\n    });\n    this.$bus.$on(\"getAdjustImageInfo\", data => {\n      this.fromAdjust.isOpen = data.isOpen;\n      this.fromAdjust.contrastOffset = data.contrastOffset;\n      this.fromAdjust.luminosityOffset = data.luminosityOffset;\n      this.fromAdjust.saturationOffset = data.saturationOffset;\n    });\n  },\n\n  beforeDestroy() {\n    this.$bus.$off(\"getUploadedInfo\");\n    this.$bus.$off(\"getAdjustImageInfo\");\n  },\n\n  methods: {\n    // cookie\n    getCookie(objName) {\n      //获取指定名称的cookie的值\n      const arrStr = document.cookie.split(\"; \");\n\n      for (let i = 0; i < arrStr.length; i++) {\n        const temp = arrStr[i].split(\"=\");\n        if (temp[0] === objName) return temp[1];\n      }\n\n      return null;\n    },\n\n    getToken() {\n      return this.getCookie(\"NBI_token\");\n    },\n\n    getUID() {\n      return this.getCookie(\"NBI_UID\");\n    },\n\n    checkUploaded() {\n      // 发送信号给send让他调用我的事件，传输数据\n      this.$bus.$emit(\"sendUploadedInfoToGet\");\n    },\n\n    getAdjustImageInfo() {\n      this.$bus.$emit(\"sendAdjustImageInfo\");\n    },\n\n    getResultImage() {\n      this.checkUploaded();\n\n      if (!this.isUploaded_fromSend) {\n        alert(\"请先完成图片上传\");\n        return;\n      }\n\n      this.isGenerating = true;\n      this.getAdjustImageInfo();\n      let getResultForm = new FormData();\n\n      if (!this.fromAdjust.isOpen) {\n        //简单生成\n        getResultForm.append(\"token\", this.getToken());\n        getResultForm.append(\"user\", this.getUID());\n        getResultForm.append(\"channelOffset\", this.channelOffset);\n        getResultForm.append(\"brightnessAdjust\", this.brightnessOffset);\n        getResultForm.append(\"isAutoChannel\", this.$refs.isAutoChannel.checked);\n        getResultForm.append(\"isAutoBrightness\", this.$refs.isAutoBrightness.checked);\n        getResultForm.append(\"mode\", \"easy\");\n      } else {\n        getResultForm.append(\"token\", this.getToken());\n        getResultForm.append(\"user\", this.getUID());\n        getResultForm.append(\"channelOffset\", this.channelOffset);\n        getResultForm.append(\"brightnessAdjust\", this.brightnessOffset);\n        getResultForm.append(\"isAutoChannel\", this.$refs.isAutoChannel.checked);\n        getResultForm.append(\"isAutoBrightness\", this.$refs.isAutoBrightness.checked);\n        getResultForm.append(\"contrastOffset\", this.fromAdjust.contrastOffset);\n        getResultForm.append(\"luminosityOffset\", this.fromAdjust.luminosityOffset);\n        getResultForm.append(\"saturationOffset\", this.fromAdjust.saturationOffset);\n        getResultForm.append(\"mode\", \"full\");\n      }\n\n      let config = {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      };\n      this.$axios.post(\"/NBI/Image/getResult/\", getResultForm, config).then(response => {\n        if (response.data === 1) {\n          alert(\"登录状态错误！\");\n        } else if (response.data === 2) {\n          alert(\"请求方式错误！\");\n        } else if (response.data === 3) {\n          alert(\"图片处理错误\");\n        } else {\n          this.showResultImage(response.data);\n        }\n\n        this.isGenerating = false;\n      });\n    },\n\n    downloadResult() {\n      // 检查是否存在生成图片\n      if (this.recordRealResult === \"\") {\n        alert(\"请先点击生成图片！\");\n        return -1;\n      }\n\n      this.$message({\n        message: '已开始下载。',\n        type: 'success'\n      });\n      this.downloadImage(\"/static/Data/NBI/\" + this.recordRealResult, \"resultNBI.jpg\");\n    },\n\n    downloadImage(imgSrc, fileName) {\n      var alink = document.createElement(\"a\");\n      alink.href = imgSrc;\n      alink.download = fileName; //fileName保存提示中用作预先填写的文件名\n\n      alink.click();\n    },\n\n    showResultImage(data) {\n      console.log(data);\n      this.isShowResult = true;\n      this.imageResultSrc = \"/static/Data/Temp/\" + data.showImage;\n      this.recordRealResult = data.resultImage;\n    }\n\n  }\n};","map":{"version":3,"mappings":"AAoGA;EACAA,uCADA;;EAEAC;IACA;MACAC,gBADA;MAEAC,mBAFA;MAGAC,mBAHA;MAIAC,0BAJA;MAKAC;QACAC,aADA;QAEAC,iBAFA;QAGAC,mBAHA;QAIAC;MAJA,CALA;MAWAC,oBAXA;MAYAC,mBAZA;MAaAC;IAbA;EAeA,CAlBA;;EAmBAC;IACA;MACA;IACA,CAFA;IAGA;MACA;MACA;MACA;MACA;IACA,CALA;EAMA,CA7BA;;EA8BAC;IACA;IACA;EACA,CAjCA;;EAkCAC;IACA;IACAC;MAAA;MACA;;MACA;QACA;QACA;MACA;;MACA;IACA,CATA;;IAUAC;MACA;IACA,CAZA;;IAaAC;MACA;IACA,CAfA;;IAgBAC;MACA;MACA;IACA,CAnBA;;IAoBAC;MACA;IACA,CAtBA;;IAuBAC;MACA;;MACA;QACAC;QACA;MACA;;MACA;MACA;MACA;;MACA;QACA;QACAC;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;MACA,CATA,MAUA;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;MACA;;MACA;QACAC;UAAA;QAAA;MADA;MAGA;QACA;UACAF;QACA,CAFA,MAGA;UACAA;QACA,CAFA,MAGA;UACAA;QACA,CAFA,MAGA;UACA;QACA;;QACA;MACA,CAdA;IAeA,CAxEA;;IAyEAG;MACA;MACA;QACAH;QACA;MACA;;MACA;QACAI,iBADA;QAEAC;MAFA;MAIA;IACA,CApFA;;IAqFAC;MACA;MACAC;MACAA,0BAHA,CAGA;;MACAA;IACA,CA1FA;;IA2FAC;MACAC;MACA;MACA;MACA;IACA;;EAhGA;AAlCA","names":["name","data","channelOffset","brightnessOffset","isGenerating","isUploaded_fromSend","fromAdjust","isOpen","contrastOffset","luminosityOffset","saturationOffset","recordRealResult","isShowResult","imageResultSrc","mounted","beforeDestroy","methods","getCookie","getToken","getUID","checkUploaded","getAdjustImageInfo","getResultImage","alert","getResultForm","headers","downloadResult","message","type","downloadImage","alink","showResultImage","console"],"sourceRoot":"src/components/singleImageProcess","sources":["singleImageProcess_imageGetPart.vue"],"sourcesContent":["<template>\r\n  <div id=\"imgShowPart\">\r\n    <div class=\"subTitle\">\r\n        <p style=\"height: 50%;font-family: STHeiti,serif;color: #363636;display: flex;justify-content: center;margin-left: 2%;\">生成结果:</p>\r\n        <div style=\"width: 100%;height: 50%;display: flex;flex-direction: row;\">\r\n          <el-button v-show=\"isGenerating\" id=\"getResultImage\" type=\"primary\" :loading=\"true\">生成中</el-button>\r\n          <button v-show=\"!isGenerating\" id=\"getResultImage\" @click=\"getResultImage()\">生成图片</button>\r\n          <button id=\"saveImage\" @click=\"downloadResult()\">保存结果</button>\r\n        </div>\r\n    </div>\r\n    <div class=\"imgPart_inner\" style=\"height: 500px;\">\r\n        <div style=\"width: 100%;height:100%;display:flex;justify-content: left;align-items: center;\">\r\n            <div id=\"imgBackPart\">\r\n                <p id=\"outImageDefault\" v-show=\"!isShowResult\">/*生成图片后查看结果*/</p>\r\n                <img v-show=\"isShowResult\" :src=\"imageResultSrc\" id=\"ShowResult\" alt=\"图片加载错误\">\r\n            </div>\r\n            <div id=\"mainControlPart\">\r\n                <div id=\"mainControlBtn\">\r\n                  <p class=\"mainControl_title\">自动调整：</p>\r\n                  <div style=\"font-family: Arial, Helvetica, sans-serif;width:85%; display:flex;flex-direction: row;height:20%; justify-content: center;align-items: center;\">\r\n                    <el-popover\r\n                      placement=\"top-start\"\r\n                      width=\"100\"\r\n                      trigger=\"hover\"\r\n                      content=\"使用后台算法自动调整输入图片强度，避免因为输入图片亮度不统一而造成的色彩偏移问题。\">\r\n                      <el-button style=\"margin-left: 20px;margin-right: 10px;\" size=\"small\" slot=\"reference\" icon=\"el-icon-link\" circle></el-button>\r\n                    </el-popover>\r\n                    <p >自动调整通道</p>\r\n                    <input type=\"checkbox\" ref=\"isAutoChannel\">\r\n                  </div>\r\n                  <div style=\"margin-top: 25px;font-family: Arial, Helvetica, sans-serif;width:85%; display:flex;flex-direction: row;height:20%; justify-content: center;align-items: center;\">\r\n                    <el-popover\r\n                      placement=\"top-start\"\r\n                      width=\"100\"\r\n                      trigger=\"hover\"\r\n                      content=\"自动调整最终生成图片的亮度，更适合观察\">\r\n                      <el-button style=\"margin-left: 20px;margin-right: 10px;\" size=\"small\" slot=\"reference\" icon=\"el-icon-link\" circle></el-button>\r\n                    </el-popover>\r\n                    <p>自动调整亮度</p>\r\n                    <input type=\"checkbox\" ref=\"isAutoBrightness\">\r\n                  </div>\r\n                </div>\r\n                <div id=\"mainControlRange\">\r\n                  <p class=\"mainControl_title\">通道偏移控制：</p>\r\n                  <div class=\"mainControlRange_container\">\r\n                    <div style=\"width: 85%;display: flex;flex-direction: row;justify-content: start;align-items: center\">\r\n                      <p>通道偏移调整：</p>\r\n                      <div style=\"width: 30px;height: 100%;display: flex;justify-content: start;align-items: center\">\r\n                        <p style=\"color: #2244CC\">{{channelOffset}}</p>\r\n                      </div>\r\n                      <el-popover\r\n                        placement=\"top-start\"\r\n                        width=\"100\"\r\n                        trigger=\"hover\"\r\n                        content=\"通道偏移，手动调整输入图片强度，在自动调整的基础上可以进一步修改。\">\r\n                        <el-button style=\"margin-left: 20px;margin-right: 10px;\" size=\"small\" slot=\"reference\" icon=\"el-icon-link\" circle></el-button>\r\n                      </el-popover>\r\n                    </div>\r\n                    <div style=\"width:85%; height: 100%;display: flex;flex-direction: column;\">\r\n                        <div style=\"width:90%; height: 30%;display: flex;flex-direction: row;\">\r\n                            <p style=\"height: 100%;font-size: small;width: 50%;text-align: left;color: rgb(255, 33, 33);font-family: Arial, Helvetica, sans-serif;\">红色增强</p>\r\n                            <p style=\"height: 100%;font-size: small;width: 50%;text-align: right;color: rgb(0, 174, 255);font-family: Arial, Helvetica, sans-serif;\">青色增强</p>\r\n                        </div>\r\n                        <div style=\"width:100%; height: 70%;display: flex;flex-direction: row;align-items: center;justify-content: center\">\r\n                            <input type=\"range\" id=\"channelAdjustRange\" min=\"-30\" max=\"30\" v-model=\"channelOffset\">\r\n                        </div>\r\n                    </div>\r\n                  </div>\r\n                  <div class=\"mainControlRange_container\">\r\n                    <div style=\"width: 85%;display: flex;flex-direction: row;justify-content: start;align-items: center\">\r\n                      <p>亮度偏移调整：</p>\r\n                      <div style=\"width: 30px;height: 100%;display: flex;justify-content: start;align-items: center\">\r\n                        <p style=\"color: #2244CC\">{{brightnessOffset}}</p>\r\n                      </div>\r\n                      <el-popover\r\n                        placement=\"top-start\"\r\n                        width=\"100\"\r\n                        trigger=\"hover\"\r\n                        content=\"亮度偏移，调整最终生成图片的亮度，在自动调整的基础上可以进一步修改。\">\r\n                        <el-button style=\"margin-left: 20px;margin-right: 10px;\" size=\"small\" slot=\"reference\" icon=\"el-icon-link\" circle></el-button>\r\n                      </el-popover>\r\n                    </div>\r\n                    <div style=\"width:85%; height: 100%;display: flex;flex-direction: column;\">\r\n                        <div style=\"width:90%; height: 30%;display: flex;flex-direction: row;\">\r\n                            <p style=\"width: 50%;text-align: left;font-family: Arial, Helvetica, sans-serif;\">降低亮度</p>\r\n                            <p style=\"width: 50%;text-align: right;font-family: Arial, Helvetica, sans-serif;\">提高亮度</p>\r\n                        </div>\r\n                        <div style=\"width:100%; height: 70%;display: flex;flex-direction: row;align-items: center;justify-content: center\">\r\n                            <input type=\"range\" id=\"brightnessAdjustRange\" class=\"checke\" min=\"-80\" max=\"80\" v-model=\"brightnessOffset\">\r\n                        </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"singleImageProcess_imageGetPart\",\r\n  data(){\r\n    return{\r\n      channelOffset: 0,\r\n      brightnessOffset: 0,\r\n      isGenerating: false,\r\n      isUploaded_fromSend: false,\r\n      fromAdjust:{\r\n        isOpen: false,\r\n        contrastOffset: 0,\r\n        luminosityOffset: 0,\r\n        saturationOffset: 0,\r\n      },\r\n      recordRealResult: \"\",\r\n      isShowResult: false,\r\n      imageResultSrc: \"\",\r\n    }\r\n  },\r\n  mounted() {\r\n    this.$bus.$on(\"getUploadedInfo\",(data)=>{\r\n      this.isUploaded_fromSend = data;\r\n    });\r\n    this.$bus.$on(\"getAdjustImageInfo\", (data)=>{\r\n      this.fromAdjust.isOpen = data.isOpen;\r\n      this.fromAdjust.contrastOffset = data.contrastOffset;\r\n      this.fromAdjust.luminosityOffset = data.luminosityOffset;\r\n      this.fromAdjust.saturationOffset = data.saturationOffset;\r\n    });\r\n  },\r\n  beforeDestroy() {\r\n    this.$bus.$off(\"getUploadedInfo\");\r\n    this.$bus.$off(\"getAdjustImageInfo\");\r\n  },\r\n  methods:{\r\n    // cookie\r\n    getCookie(objName){//获取指定名称的cookie的值\r\n      const arrStr = document.cookie.split(\"; \");\r\n      for(let i = 0; i < arrStr.length; i ++){\r\n        const temp = arrStr[i].split(\"=\");\r\n        if(temp[0] === objName) return temp[1];\r\n      }\r\n      return null;\r\n    },\r\n    getToken(){\r\n      return this.getCookie(\"NBI_token\");\r\n    },\r\n    getUID(){\r\n      return this.getCookie(\"NBI_UID\");\r\n    },\r\n    checkUploaded(){\r\n      // 发送信号给send让他调用我的事件，传输数据\r\n      this.$bus.$emit(\"sendUploadedInfoToGet\");\r\n    },\r\n    getAdjustImageInfo(){\r\n      this.$bus.$emit(\"sendAdjustImageInfo\");\r\n    },\r\n    getResultImage(){\r\n      this.checkUploaded();\r\n      if (!this.isUploaded_fromSend){\r\n          alert(\"请先完成图片上传\");\r\n          return;\r\n      }\r\n      this.isGenerating = true;\r\n      this.getAdjustImageInfo();\r\n      let getResultForm = new FormData();\r\n      if (!this.fromAdjust.isOpen){\r\n        //简单生成\r\n        getResultForm.append(\"token\", this.getToken());\r\n        getResultForm.append(\"user\", this.getUID());\r\n        getResultForm.append(\"channelOffset\", this.channelOffset);\r\n        getResultForm.append(\"brightnessAdjust\", this.brightnessOffset);\r\n        getResultForm.append(\"isAutoChannel\", this.$refs.isAutoChannel.checked);\r\n        getResultForm.append(\"isAutoBrightness\", this.$refs.isAutoBrightness.checked);\r\n        getResultForm.append(\"mode\", \"easy\")\r\n      }\r\n      else{\r\n        getResultForm.append(\"token\", this.getToken());\r\n        getResultForm.append(\"user\", this.getUID());\r\n        getResultForm.append(\"channelOffset\", this.channelOffset);\r\n        getResultForm.append(\"brightnessAdjust\", this.brightnessOffset);\r\n        getResultForm.append(\"isAutoChannel\", this.$refs.isAutoChannel.checked);\r\n        getResultForm.append(\"isAutoBrightness\", this.$refs.isAutoBrightness.checked);\r\n        getResultForm.append(\"contrastOffset\", this.fromAdjust.contrastOffset);\r\n        getResultForm.append(\"luminosityOffset\", this.fromAdjust.luminosityOffset);\r\n        getResultForm.append(\"saturationOffset\", this.fromAdjust.saturationOffset);\r\n        getResultForm.append(\"mode\", \"full\");\r\n      }\r\n      let config = {\r\n         headers: {'Content-Type': 'multipart/form-data'}\r\n      };\r\n      this.$axios.post(\"/NBI/Image/getResult/\",getResultForm, config).then((response) => {\r\n        if (response.data === 1){\r\n            alert(\"登录状态错误！\");\r\n        }\r\n        else if (response.data === 2){\r\n            alert(\"请求方式错误！\");\r\n        }\r\n        else if (response.data === 3){\r\n            alert(\"图片处理错误\");\r\n        }\r\n        else{\r\n            this.showResultImage(response.data);\r\n        }\r\n        this.isGenerating = false;\r\n      });\r\n    },\r\n    downloadResult(){\r\n        // 检查是否存在生成图片\r\n        if (this.recordRealResult === \"\"){\r\n            alert(\"请先点击生成图片！\");\r\n            return -1;\r\n        }\r\n        this.$message({\r\n          message: '已开始下载。',\r\n          type: 'success',\r\n        });\r\n        this.downloadImage(\"/static/Data/NBI/\"+this.recordRealResult, \"resultNBI.jpg\");\r\n    },\r\n    downloadImage(imgSrc, fileName){\r\n        var alink = document.createElement(\"a\");\r\n        alink.href = imgSrc;\r\n        alink.download = fileName; //fileName保存提示中用作预先填写的文件名\r\n        alink.click();\r\n    },\r\n    showResultImage(data){\r\n      console.log(data);\r\n      this.isShowResult = true;\r\n      this.imageResultSrc = \"/static/Data/Temp/\"+data.showImage;\r\n      this.recordRealResult = data.resultImage;\r\n    },\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.mainControl_title{\r\n  font-weight: bolder;\r\n  margin-left: 20px;\r\n  font-family: Arial;\r\n}\r\n#ShowResult{\r\n  width: 100%;\r\n  object-fit: contain;\r\n}\r\n#brightnessAdjustRange{\r\n    background-image: linear-gradient(to right, rgb(0, 0, 0, 1) , rgba(160, 160, 160, 0.2));;\r\n    border-radius: 10px;\r\n    width: 100%;\r\n    -webkit-appearance: none;\r\n    height:6px;\r\n}\r\n#channelAdjustRange{\r\n    background-image: linear-gradient(to right, rgb(183, 0, 0) , rgb(0, 234, 255));;\r\n    border-radius: 10px;\r\n    width: 100%;\r\n    -webkit-appearance: none;\r\n    height:6px;\r\n}\r\n#imgShowPart{\r\n    width: 100%;\r\n    /* height: 100%; */\r\n    padding-top: 5px;\r\n    overflow: hidden;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    flex-direction: column;\r\n}\r\n.subTitle{\r\n    display: flex;\r\n    align-items: flex-start;\r\n    flex-direction: column;\r\n    justify-content: left;\r\n    width: 100%;\r\n    height: 100px;\r\n    border-bottom: 1px #cbcbcb solid;\r\n    overflow: hidden;\r\n}\r\n#getResultImage{\r\n    line-height: 100%;\r\n    height: 70%;\r\n    width: 20%;\r\n    cursor: pointer;\r\n    border-radius: 5px;\r\n    background-color: rgba(154, 198, 255, 0.95);\r\n    color: #000000;\r\n    transition: 0.3s ease;\r\n    overflow: hidden;\r\n}\r\n\r\n#getResultImage:hover{\r\n    background-color: rgba(56, 56, 56, 0.78);\r\n    color: #edecd6;\r\n}\r\n\r\n#saveImage{\r\n    line-height: 100%;\r\n    height: 70%;\r\n    width: 20%;\r\n    margin-left: 2%;\r\n    margin-right: 2%;\r\n    cursor: pointer;\r\n    border-radius: 5px;\r\n    background-color: rgba(204, 255, 204, 0.78);\r\n    color: #2a2a2a;\r\n    transition: 0.3s ease;\r\n    overflow: hidden;\r\n}\r\n.imgPart_inner{\r\n    width: 98%;\r\n    display: flex;\r\n    justify-content: center;\r\n    flex-direction: column;\r\n    background-color:  rgba(126, 126, 126, 0.1);\r\n}\r\n#saveImage:hover{\r\n    background-color: rgba(56, 56, 56, 0.78);\r\n    color: #caffb1;\r\n}\r\n#imgBackPart{\r\n    width: 70%;\r\n    height: 100%;\r\n    background-color: rgba(126, 126, 126, 0.25);\r\n    border: 3px dashed rgba(170, 170, 170, 0.9);\r\n    /* border-radius: 40px; */\r\n    font-family: STHeiti;\r\n    color: #363636;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    font-weight: bold;\r\n    transition: 0.3s;\r\n    overflow: hidden;\r\n}\r\n\r\n#imgBackPart:hover{\r\n    background-color: rgba(126, 126, 126, 0.15);\r\n}\r\n#mainControlPart{\r\n    width: 30%;\r\n    display: flex;\r\n    flex-direction: column;\r\n    height: 100%;\r\n    justify-content: center;\r\n    align-items: center;\r\n}\r\ninput[type=\"checkbox\"] {\r\n  height: 22px;\r\n  width: 22px;\r\n  border: 3px rgb(0, 94, 255);\r\n  cursor: pointer;\r\n}\r\n#mainControlBtn{\r\n    width: 100%;\r\n    height: 40%;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: start;\r\n    align-items: flex-start;\r\n}\r\n#mainControlRange{\r\n    width: 100%;\r\n    height: 60%;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: start;\r\n    align-items: flex-start;\r\n}\r\n.mainControlRange_container{\r\n  width: 100%;\r\n  height: 35%;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: start;\r\n  align-items: center;\r\n}\r\n\r\n</style>"]},"metadata":{},"sourceType":"module"}