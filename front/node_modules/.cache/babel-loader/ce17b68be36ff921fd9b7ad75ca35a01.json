{"ast":null,"code":"export default {\n  name: \"singleImageProcess_imageGetPart\",\n\n  data() {\n    return {\n      channelOffset: 0,\n      brightnessOffset: 0,\n      isGenerating: false,\n      isUploaded_fromSend: false,\n      fromAdjust: {\n        isOpen: false,\n        contrastOffset: 0,\n        luminosityOffset: 0,\n        saturationOffset: 0\n      },\n      recordRealResult: \"\",\n      isShowResult: false,\n      imageResultSrc: \"\"\n    };\n  },\n\n  mounted() {\n    this.$bus.$on(\"getUploadedInfo\", data => {\n      this.isUploaded_fromSend = data;\n    });\n    this.$bus.$on(\"getAdjustImageInfo\", data => {\n      this.fromAdjust.isOpen = data.isOpen;\n      this.fromAdjust.contrastOffset = data.contrastOffset;\n      this.fromAdjust.luminosityOffset = data.luminosityOffset;\n      this.fromAdjust.saturationOffset = data.saturationOffset;\n    });\n  },\n\n  beforeDestroy() {\n    this.$bus.$off(\"getUploadedInfo\");\n    this.$bus.$off(\"getAdjustImageInfo\");\n  },\n\n  methods: {\n    // cookie\n    getCookie(objName) {\n      //获取指定名称的cookie的值\n      const arrStr = document.cookie.split(\"; \");\n\n      for (let i = 0; i < arrStr.length; i++) {\n        const temp = arrStr[i].split(\"=\");\n        if (temp[0] === objName) return temp[1];\n      }\n\n      return null;\n    },\n\n    getToken() {\n      return this.getCookie(\"NBI_token\");\n    },\n\n    getUID() {\n      return this.getCookie(\"NBI_UID\");\n    },\n\n    checkUploaded() {\n      // 发送信号给send让他调用我的事件，传输数据\n      this.$bus.$emit(\"sendUploadedInfoToGet\");\n    },\n\n    getAdjustImageInfo() {\n      this.$bus.$emit(\"sendAdjustImageInfo\");\n    },\n\n    getResultImage() {\n      this.checkUploaded();\n\n      if (!this.isUploaded_fromSend) {\n        this.$message({\n          message: \"请先完成图片上传\",\n          type: 'warning'\n        });\n        return;\n      }\n\n      this.isGenerating = true;\n      this.getAdjustImageInfo();\n      let getResultForm = new FormData();\n\n      if (!this.fromAdjust.isOpen) {\n        //简单生成\n        getResultForm.append(\"token\", this.getToken());\n        getResultForm.append(\"user\", this.getUID());\n        getResultForm.append(\"channelOffset\", this.channelOffset);\n        getResultForm.append(\"brightnessAdjust\", this.brightnessOffset);\n        getResultForm.append(\"isAutoChannel\", this.$refs.isAutoChannel.checked);\n        getResultForm.append(\"isAutoBrightness\", this.$refs.isAutoBrightness.checked);\n        getResultForm.append(\"mode\", \"easy\");\n      } else {\n        getResultForm.append(\"token\", this.getToken());\n        getResultForm.append(\"user\", this.getUID());\n        getResultForm.append(\"channelOffset\", this.channelOffset);\n        getResultForm.append(\"brightnessAdjust\", this.brightnessOffset);\n        getResultForm.append(\"isAutoChannel\", this.$refs.isAutoChannel.checked);\n        getResultForm.append(\"isAutoBrightness\", this.$refs.isAutoBrightness.checked);\n        getResultForm.append(\"contrastOffset\", this.fromAdjust.contrastOffset);\n        getResultForm.append(\"luminosityOffset\", this.fromAdjust.luminosityOffset);\n        getResultForm.append(\"saturationOffset\", this.fromAdjust.saturationOffset);\n        getResultForm.append(\"mode\", \"full\");\n      }\n\n      let config = {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      };\n      this.$axios.post(\"/NBI/Image/getResult/\", getResultForm, config).then(response => {\n        if (response.data === 1) {\n          this.$message({\n            message: '登录状态错误！',\n            type: 'error'\n          });\n        } else if (response.data === 2) {\n          this.$message({\n            message: '请求方式错误！',\n            type: 'error'\n          });\n        } else if (response.data === 3) {\n          this.$message({\n            message: '图片处理错误！',\n            type: 'error'\n          });\n        } else {\n          this.showResultImage(response.data);\n        }\n\n        this.isGenerating = false;\n      });\n    },\n\n    downloadResult() {\n      // 检查是否存在生成图片\n      if (this.recordRealResult === \"\") {\n        this.$message({\n          message: '请先点击生成图片！',\n          type: 'error'\n        });\n        return -1;\n      }\n\n      this.$message({\n        message: '已开始下载。',\n        type: 'success'\n      });\n      this.downloadImage(\"/static/Data/NBI/\" + this.recordRealResult, \"resultNBI.jpg\");\n    },\n\n    downloadImage(imgSrc, fileName) {\n      var alink = document.createElement(\"a\");\n      alink.href = imgSrc;\n      alink.download = fileName; //fileName保存提示中用作预先填写的文件名\n\n      alink.click();\n    },\n\n    showResultImage(data) {\n      this.isShowResult = true;\n      this.imageResultSrc = \"/static/Data/Temp/\" + data.showImage;\n      this.recordRealResult = data.resultImage;\n    }\n\n  }\n};","map":{"version":3,"mappings":"AA+GA;EACAA,uCADA;;EAEAC;IACA;MACAC,gBADA;MAEAC,mBAFA;MAGAC,mBAHA;MAIAC,0BAJA;MAKAC;QACAC,aADA;QAEAC,iBAFA;QAGAC,mBAHA;QAIAC;MAJA,CALA;MAWAC,oBAXA;MAYAC,mBAZA;MAaAC;IAbA;EAeA,CAlBA;;EAmBAC;IACA;MACA;IACA,CAFA;IAGA;MACA;MACA;MACA;MACA;IACA,CALA;EAMA,CA7BA;;EA8BAC;IACA;IACA;EACA,CAjCA;;EAkCAC;IACA;IACAC;MAAA;MACA;;MACA;QACA;QACA;MACA;;MACA;IACA,CATA;;IAUAC;MACA;IACA,CAZA;;IAaAC;MACA;IACA,CAfA;;IAgBAC;MACA;MACA;IACA,CAnBA;;IAoBAC;MACA;IACA,CAtBA;;IAuBAC;MACA;;MACA;QACA;UACAC,mBADA;UAEAC;QAFA;QAIA;MACA;;MACA;MACA;MACA;;MACA;QACA;QACAC;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;MACA,CATA,MAUA;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;MACA;;MACA;QACAC;UAAA;QAAA;MADA;MAGA;QACA;UACA;YACAH,kBADA;YAEAC;UAFA;QAIA,CALA,MAMA;UACA;YACAD,kBADA;YAEAC;UAFA;QAIA,CALA,MAMA;UACA;YACAD,kBADA;YAEAC;UAFA;QAIA,CALA,MAMA;UACA;QACA;;QACA;MACA,CAvBA;IAwBA,CApFA;;IAqFAG;MACA;MACA;QACA;UACAJ,oBADA;UAEAC;QAFA;QAIA;MACA;;MACA;QACAD,iBADA;QAEAC;MAFA;MAIA;IACA,CAnGA;;IAoGAI;MACA;MACAC;MACAA,0BAHA,CAGA;;MACAA;IACA,CAzGA;;IA0GAC;MACA;MACA;MACA;IACA;;EA9GA;AAlCA","names":["name","data","channelOffset","brightnessOffset","isGenerating","isUploaded_fromSend","fromAdjust","isOpen","contrastOffset","luminosityOffset","saturationOffset","recordRealResult","isShowResult","imageResultSrc","mounted","beforeDestroy","methods","getCookie","getToken","getUID","checkUploaded","getAdjustImageInfo","getResultImage","message","type","getResultForm","headers","downloadResult","downloadImage","alink","showResultImage"],"sourceRoot":"src/components/singleImageProcess","sources":["singleImageProcess_imageGetPart.vue"],"sourcesContent":["<template>\n  <div id=\"imgShowPart\">\n    <div class=\"subTitle\">\n      <p style=\"height: 50%;font-family: STHeiti,serif;color: #363636;display: flex;justify-content: center;align-items: center;margin: 0 0 0 2%;\">生成结果(Get Result):</p>\n      <div style=\"width: 100%;height: 50%;display: flex;flex-direction: row;\">\n        <div style=\"width: 60%;height: 100%;display: flex;flex-direction: row;\">\n          <el-button v-show=\"isGenerating\" id=\"getResultImage\" type=\"primary\" :loading=\"true\">生成中</el-button>\n          <button v-show=\"!isGenerating\" id=\"getResultImage\" @click=\"getResultImage()\">生成图片</button>\n<!--          TODO-->\n          <button id=\"saveImage\">保存结果</button>\n          <el-popover\n            placement=\"top-start\"\n            width=\"100\"\n            trigger=\"hover\"\n            content=\"是否在历史记录中保存此次提交，未保存的数据仅会在历史记录中保存24小时！\">\n            <el-button style=\"cursor: help;margin-left: 20px;margin-right: 10px;\" size=\"small\" slot=\"reference\" icon=\"el-icon-link\" circle></el-button>\n          </el-popover>\n        </div>\n        <div style=\"height: 100%;width: 40%;display: flex;justify-content: end;\">\n          <el-button id=\"downloadResult\" type=\"warning\" icon=\"el-icon-download\" @click=\"downloadResult()\">下载结果</el-button>\n        </div>\n      </div>\n    </div>\n    <div class=\"imgPart_inner\" style=\"height: 340px;margin-top: 10px;\">\n        <div style=\"width: 100%;height:100%;display:flex;justify-content: left;align-items: center;\">\n            <div id=\"imgBackPart\">\n                <p id=\"outImageDefault\" v-show=\"!isShowResult\">/*生成图片后查看结果*/</p>\n                <img v-show=\"isShowResult\" :src=\"imageResultSrc\" id=\"ShowResult\" alt=\"图片加载错误\">\n            </div>\n            <div id=\"mainControlPart\">\n                <div id=\"mainControlBtn\">\n                  <div style=\"font-family: Arial, Helvetica, sans-serif;width:85%; display:flex;flex-direction: row;height:20%; justify-content: center;align-items: center;\">\n                    <el-popover\n                      placement=\"top-start\"\n                      width=\"100\"\n                      trigger=\"hover\"\n                      content=\"使用后台算法自动调整输入图片强度，避免因为输入图片亮度不统一而造成的色彩偏移问题。\">\n                      <el-button style=\"cursor: help;margin-left: 20px;margin-right: 10px;\" size=\"small\" slot=\"reference\" icon=\"el-icon-link\" circle></el-button>\n                    </el-popover>\n                    <p style=\"font-family: 幼圆,serif;\">自动调整通道</p>\n                    <input type=\"checkbox\" ref=\"isAutoChannel\">\n                  </div>\n                  <div style=\"margin-top: 25px;font-family: Arial, Helvetica, sans-serif;width:85%; display:flex;flex-direction: row;height:20%; justify-content: center;align-items: center;\">\n                    <el-popover\n                      placement=\"top-start\"\n                      width=\"100\"\n                      trigger=\"hover\"\n                      content=\"自动调整最终生成图片的亮度，更适合观察\">\n                      <el-button style=\"cursor: help;margin-left: 20px;margin-right: 10px;\" size=\"small\" slot=\"reference\" icon=\"el-icon-link\" circle></el-button>\n                    </el-popover>\n                    <p style=\"font-family: 幼圆,serif;\">自动调整亮度</p>\n                    <input type=\"checkbox\" ref=\"isAutoBrightness\">\n                  </div>\n                </div>\n                <div id=\"mainControlRange\">\n                  <div class=\"mainControlRange_container\">\n                    <div style=\"width: 85%;height: 30%;display: flex;flex-direction: row;justify-content: start;align-items: center\">\n                      <p style=\"font-family: 幼圆,serif;\">通道偏移调整：</p>\n                      <div style=\"width: 30px;height: 100%;display: flex;justify-content: start;align-items: center\">\n                        <p style=\"color: #2244CC\">{{channelOffset}}</p>\n                      </div>\n                      <el-popover\n                        placement=\"top-start\"\n                        width=\"100\"\n                        trigger=\"hover\"\n                        content=\"通道偏移，手动调整输入图片强度，在自动调整的基础上可以进一步修改。\">\n                        <el-button style=\"cursor: help;margin-left: 20px;margin-right: 10px;\" size=\"small\" slot=\"reference\" icon=\"el-icon-link\" circle></el-button>\n                      </el-popover>\n                    </div>\n                    <div style=\"width:85%; height: 50%;display: flex;flex-direction: column;\">\n                        <div style=\"width:100%; height: 30%;display: flex;flex-direction: row;\">\n                            <p style=\"height: 100%;font-size: small;width: 50%;text-align: left;color: rgb(255, 33, 33);font-family: Arial, Helvetica, sans-serif;\">红色增强</p>\n                            <p style=\"height: 100%;font-size: small;width: 50%;text-align: right;color: rgb(0, 174, 255);font-family: Arial, Helvetica, sans-serif;\">青色增强</p>\n                        </div>\n                        <div style=\"width:100%; height: 70%;display: flex;flex-direction: row;align-items: center;justify-content: center\">\n                            <input type=\"range\" id=\"channelAdjustRange\" min=\"-30\" max=\"30\" v-model=\"channelOffset\">\n                        </div>\n                    </div>\n                  </div>\n                  <div class=\"mainControlRange_container\">\n                    <div style=\"width: 85%;height:30%;display: flex;flex-direction: row;justify-content: start;align-items: center\">\n                      <p style=\"font-family: 幼圆,serif;\">亮度偏移调整：</p>\n                      <div style=\"width: 30px;height: 100%;display: flex;justify-content: start;align-items: center\">\n                        <p style=\"color: #2244CC\">{{brightnessOffset}}</p>\n                      </div>\n                      <el-popover\n                        placement=\"top-start\"\n                        width=\"100\"\n                        trigger=\"hover\"\n                        content=\"亮度偏移，调整最终生成图片的亮度，在自动调整的基础上可以进一步修改。\">\n                        <el-button style=\"cursor: help;margin-left: 20px;margin-right: 10px;\" size=\"small\" slot=\"reference\" icon=\"el-icon-link\" circle></el-button>\n                      </el-popover>\n                    </div>\n                    <div style=\"width:85%; height: 50%;display: flex;flex-direction: column;\">\n                        <div style=\"width:100%; height: 30%;display: flex;flex-direction: row;font-size: small;\">\n                            <p style=\"width: 50%;text-align: left;font-family: Arial, Helvetica, sans-serif;\">降低亮度</p>\n                            <p style=\"width: 50%;text-align: right;font-family: Arial, Helvetica, sans-serif;\">提高亮度</p>\n                        </div>\n                        <div style=\"width:100%; height: 70%;display: flex;flex-direction: row;align-items: center;justify-content: center\">\n                            <input type=\"range\" id=\"brightnessAdjustRange\" class=\"checke\" min=\"-80\" max=\"80\" v-model=\"brightnessOffset\">\n                        </div>\n                    </div>\n                  </div>\n                </div>\n            </div>\n        </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: \"singleImageProcess_imageGetPart\",\n  data(){\n    return{\n      channelOffset: 0,\n      brightnessOffset: 0,\n      isGenerating: false,\n      isUploaded_fromSend: false,\n      fromAdjust:{\n        isOpen: false,\n        contrastOffset: 0,\n        luminosityOffset: 0,\n        saturationOffset: 0,\n      },\n      recordRealResult: \"\",\n      isShowResult: false,\n      imageResultSrc: \"\",\n    }\n  },\n  mounted() {\n    this.$bus.$on(\"getUploadedInfo\",(data)=>{\n      this.isUploaded_fromSend = data;\n    });\n    this.$bus.$on(\"getAdjustImageInfo\", (data)=>{\n      this.fromAdjust.isOpen = data.isOpen;\n      this.fromAdjust.contrastOffset = data.contrastOffset;\n      this.fromAdjust.luminosityOffset = data.luminosityOffset;\n      this.fromAdjust.saturationOffset = data.saturationOffset;\n    });\n  },\n  beforeDestroy() {\n    this.$bus.$off(\"getUploadedInfo\");\n    this.$bus.$off(\"getAdjustImageInfo\");\n  },\n  methods:{\n    // cookie\n    getCookie(objName){//获取指定名称的cookie的值\n      const arrStr = document.cookie.split(\"; \");\n      for(let i = 0; i < arrStr.length; i ++){\n        const temp = arrStr[i].split(\"=\");\n        if(temp[0] === objName) return temp[1];\n      }\n      return null;\n    },\n    getToken(){\n      return this.getCookie(\"NBI_token\");\n    },\n    getUID(){\n      return this.getCookie(\"NBI_UID\");\n    },\n    checkUploaded(){\n      // 发送信号给send让他调用我的事件，传输数据\n      this.$bus.$emit(\"sendUploadedInfoToGet\");\n    },\n    getAdjustImageInfo(){\n      this.$bus.$emit(\"sendAdjustImageInfo\");\n    },\n    getResultImage(){\n      this.checkUploaded();\n      if (!this.isUploaded_fromSend){\n        this.$message({\n          message: \"请先完成图片上传\",\n          type: 'warning'\n        });\n        return;\n      }\n      this.isGenerating = true;\n      this.getAdjustImageInfo();\n      let getResultForm = new FormData();\n      if (!this.fromAdjust.isOpen){\n        //简单生成\n        getResultForm.append(\"token\", this.getToken());\n        getResultForm.append(\"user\", this.getUID());\n        getResultForm.append(\"channelOffset\", this.channelOffset);\n        getResultForm.append(\"brightnessAdjust\", this.brightnessOffset);\n        getResultForm.append(\"isAutoChannel\", this.$refs.isAutoChannel.checked);\n        getResultForm.append(\"isAutoBrightness\", this.$refs.isAutoBrightness.checked);\n        getResultForm.append(\"mode\", \"easy\")\n      }\n      else{\n        getResultForm.append(\"token\", this.getToken());\n        getResultForm.append(\"user\", this.getUID());\n        getResultForm.append(\"channelOffset\", this.channelOffset);\n        getResultForm.append(\"brightnessAdjust\", this.brightnessOffset);\n        getResultForm.append(\"isAutoChannel\", this.$refs.isAutoChannel.checked);\n        getResultForm.append(\"isAutoBrightness\", this.$refs.isAutoBrightness.checked);\n        getResultForm.append(\"contrastOffset\", this.fromAdjust.contrastOffset);\n        getResultForm.append(\"luminosityOffset\", this.fromAdjust.luminosityOffset);\n        getResultForm.append(\"saturationOffset\", this.fromAdjust.saturationOffset);\n        getResultForm.append(\"mode\", \"full\");\n      }\n      let config = {\n         headers: {'Content-Type': 'multipart/form-data'}\n      };\n      this.$axios.post(\"/NBI/Image/getResult/\",getResultForm, config).then((response) => {\n        if (response.data === 1){\n            this.$message({\n              message: '登录状态错误！',\n              type: 'error'\n            });\n        }\n        else if (response.data === 2){\n          this.$message({\n            message: '请求方式错误！',\n            type: 'error'\n          });\n        }\n        else if (response.data === 3){\n          this.$message({\n            message: '图片处理错误！',\n            type: 'error'\n          });\n        }\n        else{\n            this.showResultImage(response.data);\n        }\n        this.isGenerating = false;\n      });\n    },\n    downloadResult(){\n        // 检查是否存在生成图片\n        if (this.recordRealResult === \"\"){\n          this.$message({\n            message: '请先点击生成图片！',\n            type: 'error'\n          });\n          return -1;\n        }\n        this.$message({\n          message: '已开始下载。',\n          type: 'success',\n        });\n        this.downloadImage(\"/static/Data/NBI/\"+this.recordRealResult, \"resultNBI.jpg\");\n    },\n    downloadImage(imgSrc, fileName){\n        var alink = document.createElement(\"a\");\n        alink.href = imgSrc;\n        alink.download = fileName; //fileName保存提示中用作预先填写的文件名\n        alink.click();\n    },\n    showResultImage(data){\n      this.isShowResult = true;\n      this.imageResultSrc = \"/static/Data/Temp/\"+data.showImage;\n      this.recordRealResult = data.resultImage;\n    },\n  }\n}\n</script>\n\n<style scoped>\n#ShowResult{\n  width: 100%;\n  height: 100%;\n  object-fit: contain;\n}\n#brightnessAdjustRange{\n    background-image: linear-gradient(to right, rgb(0, 0, 0, 1) , rgba(160, 160, 160, 0.2));;\n    border-radius: 10px;\n    width: 100%;\n    -webkit-appearance: none;\n    height:4px;\n}\n#channelAdjustRange{\n    background-image: linear-gradient(to right, rgb(183, 0, 0) , rgb(0, 234, 255));;\n    border-radius: 10px;\n    width: 100%;\n    -webkit-appearance: none;\n    height:4px;\n}\n#imgShowPart{\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-direction: column;\n    border-bottom: 1px grey solid;\n}\n.subTitle{\n    display: flex;\n    align-items: flex-start;\n    flex-direction: column;\n    justify-content: left;\n    width: 100%;\n    height: 100px;\n    border-bottom: 1px #cbcbcb solid;\n    overflow: hidden;\n}\n#getResultImage{\n    height: 70%;\n    width: 30%;\n    margin-left: 3%;\n    cursor: pointer;\n    border-radius: 3px;\n    background-color: #409eff;\n    color: white;\n    transition: 0.3s ease;\n    overflow: hidden;\n}\n#getResultImage:hover{\n    background-color: rgba(56, 56, 56, 0.78);\n    color: #edecd6;\n}\n#downloadResult{\n  width: 48%;\n  height: 70%;\n  font-size: small;\n  border: 1px grey solid;\n  margin-right: 5%;\n}\n#saveImage{\n    line-height: 100%;\n    height: 70%;\n    width: 30%;\n    margin-left: 2%;\n    cursor: pointer;\n    border-radius: 3px;\n    background-color: rgba(60, 197, 60, 0.78);\n    color: white;\n    transition: 0.3s ease;\n    overflow: hidden;\n}\n.imgPart_inner{\n    width: 98%;\n    display: flex;\n    justify-content: center;\n    flex-direction: column;\n}\n#saveImage:hover{\n    background-color: rgba(56, 56, 56, 0.78);\n    color: #caffb1;\n}\n#imgBackPart{\n    width: 70%;\n    height: 95%;\n    background-color: rgba(126, 126, 126, 0.25);\n    border: 2px solid black;\n    /* border-radius: 40px; */\n    font-family: STHeiti,serif;\n    color: #363636;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    font-weight: bold;\n    transition: 0.3s;\n}\n\n#imgBackPart:hover{\n    background-color: rgba(126, 126, 126, 0.15);\n}\n#mainControlPart{\n    width: 30%;\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    justify-content: center;\n    align-items: center;\n}\ninput[type=\"checkbox\"] {\n  height: 22px;\n  width: 22px;\n  border: 3px rgb(0, 94, 255);\n  cursor: pointer;\n}\n#mainControlBtn{\n    width: 100%;\n    height: 25%;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    border-bottom: 1px grey solid;\n}\n#mainControlRange{\n    width: 100%;\n    height: 75%;\n    display: flex;\n    flex-direction: column;\n    justify-content: start;\n    align-items: flex-start;\n}\n.mainControlRange_container{\n  width: 100%;\n  height: 50%;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n}\n\n</style>"]},"metadata":{},"sourceType":"module"}